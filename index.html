<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Memorization App</title>
<style>
  body {
    background: #1E1F40;
    color: #FFFFFF;
    font-family: monospace;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 20px;
  }
  #console {
    background: #0C0E1B;
    width: 90%;
    max-width: 600px;
    height: 400px;
    overflow-y: auto;
    padding: 10px;
    border-radius: 8px;
    margin-bottom: 10px;
    white-space: pre-wrap;
  }
  input[type="text"] {
    width: 90%;
    max-width: 600px;
    padding: 10px;
    font-family: monospace;
    font-size: 16px;
    border-radius: 5px;
    border: none;
  }
  button {
    margin-top: 10px;
    padding: 8px 16px;
    font-family: monospace;
    font-size: 16px;
    border-radius: 5px;
    border: none;
    background: #AB5DCE;
    color: white;
    cursor: pointer;
  }
  button:hover {
    background: #FF69B4;
  }
</style>
</head>
<body>

<h1>Memorization App</h1>
<div id="console"></div>
<input type="text" id="userInput" placeholder="Type here..." autofocus />
<button id="submitBtn">Submit</button>

<script>
const consoleDiv = document.getElementById('console');
const userInput = document.getElementById('userInput');
const submitBtn = document.getElementById('submitBtn');

let text = '';
let words = [];
let currentIndex = 1;
let correctCount = 0;
let state = 'inputParagraph'; // inputParagraph, practicing, finalScore

function appendConsole(msg, newLine = true) {
  if (newLine) {
    consoleDiv.innerHTML += msg + "<br>";
  } else {
    consoleDiv.innerHTML += msg + " ";
  }
  consoleDiv.scrollTop = consoleDiv.scrollHeight;
}
function clearConsole() {
  consoleDiv.textContent = "\n".repeat(40); // mimic clear screen
}

function showWords(wordsToShow, callback) {
  let i = 0;
  function showNext() {
    if (i < wordsToShow.length) {
      appendConsole(wordsToShow[i], false); // <-- space, not newline
      i++;
      setTimeout(showNext, 400);
    } else {
      appendConsole(""); // add a line break after the phrase
      callback();
    }
  }
  showNext();
}

function practiceStep() {
  const shownWords = words.slice(0, currentIndex);
  clearConsole();
  appendConsole(`Memorize the first ${currentIndex} words:\n`);
  showWords(shownWords, () => {
    // clear again right before input prompt
    clearConsole();
    appendConsole(`Type the first ${currentIndex} words and press Submit.`);
    state = 'waitingPracticeInput';
  });
}

function finalScoreStep() {
  clearConsole();
  appendConsole('Now enter the full paragraph and press Submit:');
  state = 'waitingFinalInput';
}

submitBtn.addEventListener('click', () => {
  const input = userInput.value.trim();
  userInput.value = '';

  if (state === 'inputParagraph') {
    text = input;
    words = text.split(' ');
    appendConsole('\nParagraph saved. Starting practice...');
    practiceStep();
    state = 'practicing';
  }
  else if (state === 'waitingPracticeInput') {
    const shownWords = words.slice(0, currentIndex);
    if (input.toLowerCase() === shownWords.join(' ').toLowerCase()) {
      appendConsole('\nâœ… Correct!');
      correctCount++;
      currentIndex++;
      if (currentIndex <= words.length) {
        practiceStep();
      } else {
        appendConsole('\nPractice complete!');
        finalScoreStep();
      }
    } else {
      appendConsole('\nâŒ Wrong! Try again.');
      setTimeout(practiceStep, 700); // short pause before retry
    }
  }
  else if (state === 'waitingFinalInput') {
    if (input.toLowerCase() === text.toLowerCase()) {
      appendConsole(`\nðŸŽ‰ Final Score: ${correctCount}/${words.length} (${((correctCount/words.length)*100).toFixed(1)}%)`);
      appendConsole('You memorized it perfectly!');
    } else {
      appendConsole('\nâŒ Incorrect. You can retry the paragraph or redo practice.');
      state = 'finalScoreChoice';
      appendConsole('\nType 1 to retry final input, 2 to redo practice and press Submit.');
    }
  }
  else if (state === 'finalScoreChoice') {
    if (input === '1') {
      finalScoreStep();
    } else if (input === '2') {
      currentIndex = 1;
      correctCount = 0;
      practiceStep();
      state = 'practicing';
    } else {
      appendConsole('\nInvalid choice, defaulting to retry final input.');
      finalScoreStep();
    }
  }
});

// allow Enter key to submit
userInput.addEventListener('keypress', function(e) {
  if (e.key === 'Enter') {
    submitBtn.click();
  }
});
</script>

</body>
</html>
